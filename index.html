<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>待办功能页面</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Source Han Sans CN", "Urbanist", sans-serif;
        }
        
        body {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        .left-sidebar {
            width: 372px;
            height: 100%;
            background-image: url('bg0.png');
            background-size: cover;
            background-position: center;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            padding: 16px;
            background-color: #f5f7f9;
        }
        
        .content-wrapper {
            display: flex;
            width: 100%;
            gap: 16px;
        }
        
        .todo-container {
            display: flex;
            flex-direction: column;
            gap: 28px;
            padding: 36px;
            background-color: #FFFFFF;
            border-radius: 6px;
            border: 0.5px solid #EBEBEB;
            box-shadow: 0px 2px 16px 0px rgba(170, 170, 170, 0.03);
            flex: 1;
            max-height: calc(100vh - 32px);
            overflow-y: auto;
        }
        
        .calendar-container {
            display: flex;
            flex-direction: column;
            gap: 28px;
            padding: 36px;
            background-color: #FFFFFF;
            border-radius: 6px;
            border: 0.5px solid #EBEBEB;
            box-shadow: 0px 2px 16px 0px rgba(170, 170, 170, 0.03);
            width: 320px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .welcome {
            font-size: 28px;
            font-weight: 600;
            color: #3F3D56;
        }
        
        .todo-count {
            font-size: 18px;
            font-weight: 500;
            color: #8D9CB8;
        }
        
        .action-buttons {
            display: flex;
            gap: 16px;
        }
        
        .btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 0 12px;
            height: 32px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .btn-primary {
            background-color: #F0F5F8;
            color: #2A2A2A;
            border: 1px solid #E9E9E9;
        }
        
        .btn-gradient {
            background-color: #FFFFFF;
            color: #5B70EA;
            border: 1px solid;
            border-image: linear-gradient(to right, #ACB0FA, #98CCFC, #C58EF8) 1;
        }
        
        .todo-list {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .todo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background-color: #F5F7F9;
            border-radius: 20px;
        }
        
        .todo-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .checkbox {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .checkbox.unchecked {
            background-color: #FFFFFF;
            border: 2px solid #C6CFDC;
        }
        
        .checkbox.checked {
            background-color: #007FFF;
        }
        
        .checkbox.checked svg {
            fill: none;
            stroke: white;
            stroke-width: 2;
        }
        
        .todo-text {
            font-size: 18px;
            color: #8D9CB8;
        }
        
        .todo-text.active {
            color: #3F3D56;
        }
        
        .todo-text.completed {
            text-decoration: line-through;
            color: #8D9CB8;
        }
        
        .tag-container {
            display: flex;
            gap: 8px;
        }
        
        .tag {
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 12px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tag-urgent {
            background-color: #FFF5F0;
            color: #D4340F;
        }
        
        .tag-high {
            background-color: #FFF5E6;
            color: #E19140;
        }
        
        .tag-medium {
            background-color: #F0F9FF;
            color: #577EBA;
        }
        
        .tag-low {
            background-color: #FFFCE6;
            color: #A99274;
        }
        
        .tag-system {
            background-color: #FFF5E6;
            color: #E19140;
        }
        
        .tag-security {
            background-color: #FFF5F0;
            color: #D4340F;
        }
        
        .tag-customer {
            background-color: #F0F9FF;
            color: #577EBA;
        }
        
        .completed-section {
            margin-top: 20px;
        }
        
        .completed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .completed-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
            color: #8D9CB8;
        }
        
        .delete-all {
            font-size: 18px;
            font-weight: 600;
            color: #FF5E5E;
            cursor: pointer;
            position: relative;
        }
        
        .delete-all::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #FFB4AB;
        }
        
        .completed-list {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        /* 日历样式 */
        .month-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .month-title {
            font-weight: 700;
            font-size: 12px;
            color: #333333;
        }
        
        .arrows {
            display: flex;
            gap: 10px;
        }
        
        .arrow {
            cursor: pointer;
            width: 16px;
            height: 16px;
        }
        
        .calendar-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            margin-bottom: 8px;
        }
        
        .weekday {
            font-weight: 500;
            font-size: 12px;
            color: #333333;
        }
        
        .week {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            gap: 8px 0;
        }
        
        .day {
            font-weight: 500;
            font-size: 12px;
            color: #666666;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            cursor: pointer;
        }
        
        .day.current {
            background-color: #FB3F4A;
            color: white;
            border-radius: 50%;
        }
        
        .day.selected {
            background-color: #5B70EA;
            color: white;
            border-radius: 50%;
        }
        
        .day.empty {
            cursor: default;
        }
        
        .calendar-divider {
            height: 1px;
            background-color: #F7F7F7;
            margin: 16px 0;
        }
        
        .event-section {
            margin-top: 16px;
        }
        
        .event-title {
            font-size: 12px;
            color: #666666;
            margin-bottom: 4px;
        }
        
        .event-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 4px;
        }
        
        /* 弹出对话框样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s linear 0.25s, opacity 0.25s;
        }
        
        .modal-overlay.active {
            visibility: visible;
            opacity: 1;
            transition-delay: 0s;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            width: 500px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .modal-header {
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #3F3D56;
        }
        
        .modal-body {
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #8D9CB8;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #E9E9E9;
            border-radius: 4px;
            font-size: 16px;
            resize: vertical;
            min-height: 100px;
        }
        
        .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #E9E9E9;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .btn-modal {
            padding: 8px 20px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            border: none;
        }
        
        .btn-cancel {
            background-color: #F0F5F8;
            color: #8D9CB8;
        }
        
        .btn-submit {
            background-color: #5B70EA;
            color: white;
        }
    </style>
</head>
<body>
    <div class="left-sidebar"></div>
    <div class="main-content">
        <div class="content-wrapper">
            <div class="calendar-container">
                <div class="month-selector">
                    <div class="month-title" id="monthTitle">2025年 3月</div>
                    <div class="arrows">
                        <div class="arrow" id="prevMonth">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M10 4L6 8L10 12" stroke="#333333" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="arrow" id="nextMonth">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6 4L10 8L6 12" stroke="#333333" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <div class="calendar-grid" id="calendarGrid">
                    <div class="weekdays">
                        <div class="weekday">Mo</div>
                        <div class="weekday">Tu</div>
                        <div class="weekday">We</div>
                        <div class="weekday">Th</div>
                        <div class="weekday">Fr</div>
                        <div class="weekday">Sa</div>
                        <div class="weekday">Su</div>
                    </div>
                    
                    <!-- 日历内容将通过JavaScript动态生成 -->
                </div>
                
                <div class="calendar-divider"></div>
                
                <div class="event-section">
                    <div class="event-title">优先级</div>
                    <div class="event-tags">
                        <div class="tag tag-urgent">紧急</div>
                        <div class="tag tag-high">高</div>
                        <div class="tag tag-medium">中</div>
                        <div class="tag tag-low">低</div>
                    </div>
                </div>
                
                <div class="event-section">
                    <div class="event-title">类型</div>
                    <div class="event-tags">
                        <div class="tag tag-security">安全事件</div>
                        <div class="tag tag-system">系统警报</div>
                        <div class="tag tag-customer">客户需求</div>
                    </div>
                </div>
            </div>
            
            <div class="todo-container">
                <div class="header">
                    <div class="user-info">
                        <h1 class="welcome">Welcome, 石海宏.</h1>
                        <p class="todo-count">你有 5 条待办</p>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary">
                            <span>新建</span>
                        </button>
                        <button class="btn btn-gradient">
                            <span>生成待办</span>
                        </button>
                    </div>
                </div>
                
                <div class="todo-list">
                    <!-- 待办项目将通过JavaScript动态生成 -->
                </div>
                
                <div class="completed-section">
                    <div class="completed-header">
                        <div class="completed-title">
                            <span>已完成</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6 9L12 15L18 9" stroke="#8D9CB8" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="delete-all">删除全部</div>
                    </div>
                    
                    <div class="completed-list">
                        <div class="todo-item">
                            <div class="todo-left">
                                <div class="checkbox checked">
                                    <svg width="14" height="10" viewBox="0 0 14 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M1 5L5 9L13 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                                <div class="todo-text">Design use case page</div>
                            </div>
                        </div>
                        
                        <div class="todo-item">
                            <div class="todo-left">
                                <div class="checkbox checked">
                                    <svg width="14" height="10" viewBox="0 0 14 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M1 5L5 9L13 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                                <div class="todo-text">Design use case page</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 新建待办对话框 -->
    <div class="modal-overlay" id="newTodoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">新建待办</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">待办内容</label>
                    <textarea class="form-control" id="todoContent" placeholder="请输入待办内容..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">优先级</label>
                    <select class="form-select" id="todoPriority">
                        <option value="紧急">紧急</option>
                        <option value="高">高</option>
                        <option value="中">中</option>
                        <option value="低">低</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">类型</label>
                    <select class="form-select" id="todoType">
                        <option value="系统警报">系统警报</option>
                        <option value="安全事件">安全事件</option>
                        <option value="客户需求">客户需求</option>
                        <option value="研发延期">研发延期</option>
                        <option value="舆情监控">舆情监控</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-cancel" id="cancelTodo">取消</button>
                <button class="btn-modal btn-submit" id="submitTodo">确定</button>
            </div>
        </div>
    </div>
    
    <script>
        // 从CSV数据中随机选择5条待办事项
        const todoData = [
            { content: "@所有人 主数据库连接异常，交易系统已瘫痪，技术团队立即响应！", type: "系统警报", priority: "紧急" },
            { content: "检测到财务部账号异常登录（IP:192.168.1.23），所有人员暂停资金操作！", type: "安全事件", priority: "紧急" },
            { content: "客户 E 要求增加 API 接口，技术评估报告需明日 10 点前提交！", type: "客户需求", priority: "高" },
            { content: "产品 V2.0 核心功能测试未通过，延期发布需同步董事会！", type: "研发延期", priority: "紧急" },
            { content: "社交媒体出现产品虚假宣传截图，品牌部立即澄清！", type: "舆情监控", priority: "紧急" },
            { content: "芯片库存仅够维持 2 周生产，采购部紧急会议！", type: "供应链预警", priority: "紧急" },
            { content: "大客户 A 项目数据泄露，法务、公关、技术负责人速联！", type: "客户危机", priority: "紧急" },
            { content: "CEO 紧急通知：全员立即停止外发文件，等待安全审计！", type: "高管指令", priority: "紧急" },
            { content: "AWS 东京区域宕机，海外订单系统不可用，运维组启动灾备！", type: "服务器崩溃", priority: "紧急" },
            { content: "项目 X 里程碑延迟 3 天，@PMO 重新排期并同步客户！", type: "项目风险", priority: "高" },
            { content: "流水线 3 号机械臂失控，请安全组 10 分钟内到现场！", type: "生产事故", priority: "紧急" },
            { content: "大客户 J CEO 临时到访，销售 VP 需 30 分钟内到接待厅！", type: "客户拜访", priority: "紧急" },
            { content: "误删供应链系统访问权限，请 IT 部优先恢复！", type: "权限误删", priority: "紧急" },
            { content: "明日 14:00 季度复盘会，请提交部门总结 PPT 至共享盘", type: "会议通知", priority: "中" },
            { content: "新版员工手册已更新，请各部门负责人传达", type: "文件共享", priority: "中" },
            { content: "请问差旅标准中高铁一等座是否需要 VP 审批？", type: "流程咨询", priority: "中" },
            { content: "新增 CRM 系统操作指南第三章，建议新人学习", type: "知识库更新", priority: "中" },
            { content: "IT 部：显示器补货到仓，需申请者填写表单", type: "设备申领", priority: "中" },
            { content: "下周三 Excel 高阶培训开放报名，限额 30 人", type: "培训报名", priority: "中" },
            { content: "本周五下午全员大扫除，请整理工位", type: "行政通知", priority: "中" }
        ];
        
        // 日历相关变量
        let currentDate = new Date();
        currentDate.setFullYear(2025, 2, 8); // 设置为2025年3月8日
        let selectedDate = new Date(currentDate);
        
        // 用于跟踪已使用的待办索引
        let usedIndices = new Set();
        
        // 初始化日历和待办列表
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化日历
            renderCalendar();
            
            // 初始化待办列表
            refreshTodoList();
            
            // 初始化已完成列表
            refreshCompletedList();
            
            // 绑定日历导航事件
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });
            
            document.getElementById('nextMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });
            
            // 初始绑定复选框事件
            bindCheckboxEvents();
            
            // 删除全部已完成项
            document.querySelector('.delete-all').addEventListener('click', function() {
                document.querySelector('.completed-list').innerHTML = '';
                
                // 重新生成已完成列表
                refreshCompletedList();
            });
            
            // 新建待办按钮点击事件
            document.querySelector('.btn-primary').addEventListener('click', function() {
                document.getElementById('newTodoModal').classList.add('active');
            });
            
            // 取消新建待办
            document.getElementById('cancelTodo').addEventListener('click', function() {
                document.getElementById('newTodoModal').classList.remove('active');
                document.getElementById('todoContent').value = '';
            });
            
            // 提交新建待办
            document.getElementById('submitTodo').addEventListener('click', function() {
                const content = document.getElementById('todoContent').value.trim();
                if (!content) {
                    alert('请输入待办内容');
                    return;
                }
                
                const priority = document.getElementById('todoPriority').value;
                const type = document.getElementById('todoType').value;
                
                // 创建新的待办项
                const priorityClass = getPriorityClass(priority);
                const typeClass = getTypeClass(type);
                
                const todoItemHTML = `
                    <div class="todo-item">
                        <div class="todo-left">
                            <div class="checkbox unchecked"></div>
                            <div class="todo-text active">${content}</div>
                        </div>
                        <div class="tag-container">
                            <div class="tag ${priorityClass}">${priority}</div>
                            <div class="tag ${typeClass}">${type}</div>
                        </div>
                    </div>
                `;
                
                // 添加到待办列表
                const todoListElement = document.querySelector('.todo-list');
                todoListElement.innerHTML += todoItemHTML;
                
                // 重新绑定复选框事件
                bindCheckboxEvents();
                
                // 更新待办数量
                updateTodoCount();
                
                // 关闭对话框并清空输入
                document.getElementById('newTodoModal').classList.remove('active');
                document.getElementById('todoContent').value = '';
            });
            
            // 点击对话框外部关闭对话框
            document.getElementById('newTodoModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                    document.getElementById('todoContent').value = '';
                }
            });
            
            // 生成待办按钮点击事件
            document.querySelector('.btn-gradient').addEventListener('click', function() {
                // 获取未使用的待办数据
                const unusedTodos = [];
                
                for (let i = 0; i < todoData.length; i++) {
                    if (!usedIndices.has(i)) {
                        unusedTodos.push({
                            todo: todoData[i],
                            index: i
                        });
                    }
                }
                
                // 如果所有数据都已使用，则重置使用状态
                if (unusedTodos.length < 2) {
                    usedIndices.clear();
                    
                    // 重新获取所有可用数据
                    unusedTodos.length = 0;
                    for (let i = 0; i < todoData.length; i++) {
                        unusedTodos.push({
                            todo: todoData[i],
                            index: i
                        });
                    }
                }
                
                // 随机选择2条待办
                const newTodos = [];
                const shuffled = [...unusedTodos].sort(() => 0.5 - Math.random());
                
                // 选择2条
                const count = Math.min(2, shuffled.length);
                
                for (let i = 0; i < count; i++) {
                    newTodos.push(shuffled[i].todo);
                    usedIndices.add(shuffled[i].index);
                }
                
                // 添加到待办列表
                const todoListElement = document.querySelector('.todo-list');
                newTodos.forEach(todo => {
                    const priorityClass = getPriorityClass(todo.priority);
                    const typeClass = getTypeClass(todo.type);
                    
                    const todoItemHTML = `
                        <div class="todo-item">
                            <div class="todo-left">
                                <div class="checkbox unchecked"></div>
                                <div class="todo-text active">${todo.content}</div>
                            </div>
                            <div class="tag-container">
                                <div class="tag ${priorityClass}">${todo.priority}</div>
                                <div class="tag ${typeClass}">${todo.type}</div>
                            </div>
                        </div>
                    `;
                    
                    todoListElement.innerHTML += todoItemHTML;
                });
                
                // 重新绑定复选框事件
                bindCheckboxEvents();
                
                // 更新待办数量
                updateTodoCount();
            });
        });
        
        // 渲染日历
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // 更新月份标题
            const monthNames = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];
            document.getElementById('monthTitle').textContent = `${year}年 ${monthNames[month]}`;
            
            // 获取当月第一天是星期几
            const firstDay = new Date(year, month, 1);
            const firstDayIndex = firstDay.getDay() || 7; // 将星期日(0)转换为7，以便与星期一(1)对齐
            
            // 获取当月的天数
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // 获取上个月的天数
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            // 清空日历网格
            const calendarGrid = document.getElementById('calendarGrid');
            // 保留星期标题行
            calendarGrid.innerHTML = `
                <div class="weekdays">
                    <div class="weekday">Mo</div>
                    <div class="weekday">Tu</div>
                    <div class="weekday">We</div>
                    <div class="weekday">Th</div>
                    <div class="weekday">Fr</div>
                    <div class="weekday">Sa</div>
                    <div class="weekday">Su</div>
                </div>
            `;
            
            // 计算需要显示的行数
            const totalDays = firstDayIndex - 1 + daysInMonth;
            const rows = Math.ceil(totalDays / 7);
            
            let date = 1;
            let nextMonthDate = 1;
            
            // 生成日历行
            for (let i = 0; i < rows; i++) {
                const weekRow = document.createElement('div');
                weekRow.className = 'week';
                
                // 生成每一行的7个单元格
                for (let j = 0; j < 7; j++) {
                    const dayCell = document.createElement('div');
                    dayCell.className = 'day';
                    
                    // 填充上个月的日期
                    if (i === 0 && j < firstDayIndex - 1) {
                        const prevMonthDay = daysInPrevMonth - (firstDayIndex - 2 - j);
                        dayCell.textContent = prevMonthDay;
                        dayCell.classList.add('empty');
                    }
                    // 填充当月的日期
                    else if (date <= daysInMonth) {
                        dayCell.textContent = date;
                        
                        // 标记当前日期
                        const currentDateObj = new Date(currentDate);
                        currentDateObj.setDate(date);
                        
                        // 检查是否是当前选中的日期
                        if (selectedDate && 
                            selectedDate.getDate() === date && 
                            selectedDate.getMonth() === month && 
                            selectedDate.getFullYear() === year) {
                            dayCell.classList.add('selected');
                        }
                        
                        // 检查是否是今天（2025年3月8日）
                        if (date === 8 && month === 2 && year === 2025) {
                            dayCell.classList.add('current');
                        }
                        
                        // 添加点击事件
                        dayCell.addEventListener('click', () => {
                            // 移除之前选中的日期样式
                            const prevSelected = document.querySelector('.day.selected');
                            if (prevSelected) {
                                prevSelected.classList.remove('selected');
                            }
                            
                            // 添加新选中的日期样式
                            dayCell.classList.add('selected');
                            
                            // 更新选中的日期
                            selectedDate = new Date(year, month, date);
                            
                            // 刷新待办列表
                            refreshTodoList();
                        });
                        
                        date++;
                    }
                    // 填充下个月的日期
                    else {
                        dayCell.textContent = nextMonthDate;
                        dayCell.classList.add('empty');
                        nextMonthDate++;
                    }
                    
                    weekRow.appendChild(dayCell);
                }
                
                calendarGrid.appendChild(weekRow);
            }
        }
        
        // 刷新待办列表
        function refreshTodoList() {
            // 随机选择5条待办事项
            const selectedTodos = [];
            const tempUsedIndices = new Set(usedIndices);
            
            // 随机选择1-5条待办事项
            const numTodos = Math.floor(Math.random() * 5) + 1; // 随机1-5条
            
            while (selectedTodos.length < numTodos && tempUsedIndices.size < todoData.length) {
                const randomIndex = Math.floor(Math.random() * todoData.length);
                if (!tempUsedIndices.has(randomIndex)) {
                    selectedTodos.push(todoData[randomIndex]);
                    tempUsedIndices.add(randomIndex);
                    usedIndices.add(randomIndex);
                }
            }
            
            // 如果所有数据都已使用，则重置使用状态
            if (tempUsedIndices.size >= todoData.length) {
                usedIndices.clear();
            }
            
            // 渲染待办事项
            const todoListElement = document.querySelector('.todo-list');
            todoListElement.innerHTML = ''; // 清空现有待办
            
            selectedTodos.forEach(todo => {
                const priorityClass = getPriorityClass(todo.priority);
                const typeClass = getTypeClass(todo.type);
                
                const todoItemHTML = `
                    <div class="todo-item">
                        <div class="todo-left">
                            <div class="checkbox unchecked"></div>
                            <div class="todo-text active">${todo.content}</div>
                        </div>
                        <div class="tag-container">
                            <div class="tag ${priorityClass}">${todo.priority}</div>
                            <div class="tag ${typeClass}">${todo.type}</div>
                        </div>
                    </div>
                `;
                
                todoListElement.innerHTML += todoItemHTML;
            });
            
            // 重新绑定复选框事件
            bindCheckboxEvents();
            
            // 更新待办数量
            updateTodoCount();
            
            // 更新页面标题显示选中的日期
            const formattedDate = formatDate(selectedDate);
            document.querySelector('.welcome').textContent = `Welcome, 石海宏. (${formattedDate})`;
        }
        
        // 格式化日期为 "YYYY-MM-DD" 格式
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // 获取优先级对应的CSS类
        function getPriorityClass(priority) {
            switch (priority) {
                case '紧急': return 'tag-urgent';
                case '高': return 'tag-high';
                case '中': return 'tag-medium';
                case '低': return 'tag-low';
                default: return 'tag-medium';
            }
        }
        
        // 获取类型对应的CSS类
        function getTypeClass(type) {
            switch (type) {
                case '系统警报': return 'tag-system';
                case '安全事件': return 'tag-security';
                case '客户需求': 
                case '客户危机': return 'tag-customer';
                default: return 'tag-system';
            }
        }
        
        // 绑定复选框事件的函数
        function bindCheckboxEvents() {
            const checkboxes = document.querySelectorAll('.checkbox');
            
            checkboxes.forEach(checkbox => {
                // 移除旧的事件监听器
                checkbox.removeEventListener('click', checkboxClickHandler);
                // 添加新的事件监听器
                checkbox.addEventListener('click', checkboxClickHandler);
            });
        }
        
        // 复选框点击处理函数
        function checkboxClickHandler() {
            this.classList.toggle('checked');
            this.classList.toggle('unchecked');
            
            // 切换复选框内的SVG
            if (this.classList.contains('checked')) {
                this.innerHTML = `
                    <svg width="14" height="10" viewBox="0 0 14 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1 5L5 9L13 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                `;
                
                // 获取整个待办项
                const todoItem = this.closest('.todo-item');
                
                // 切换文本样式
                const todoText = this.nextElementSibling;
                todoText.classList.toggle('active');
                todoText.classList.toggle('completed');
                
                // 1秒后移动到已完成列表
                setTimeout(() => {
                    // 检查是否在待办列表中
                    if (todoItem.parentElement.classList.contains('todo-list')) {
                        // 从待办列表中移除
                        todoItem.parentElement.removeChild(todoItem);
                        
                        // 添加到已完成列表
                        const completedList = document.querySelector('.completed-list');
                        completedList.appendChild(todoItem);
                        
                        // 更新待办数量
                        updateTodoCount();
                    }
                }, 1000);
            } else {
                this.innerHTML = '';
                
                // 获取整个待办项
                const todoItem = this.closest('.todo-item');
                
                // 切换文本样式
                const todoText = this.nextElementSibling;
                todoText.classList.toggle('active');
                todoText.classList.toggle('completed');
                
                // 1秒后移回待办列表
                setTimeout(() => {
                    // 检查是否在已完成列表中
                    if (todoItem.parentElement.classList.contains('completed-list')) {
                        // 从已完成列表中移除
                        todoItem.parentElement.removeChild(todoItem);
                        
                        // 添加到待办列表
                        const todoList = document.querySelector('.todo-list');
                        todoList.appendChild(todoItem);
                        
                        // 更新待办数量
                        updateTodoCount();
                    }
                }, 1000);
            }
        }
        
        // 更新待办数量的函数
        function updateTodoCount() {
            const todoCount = document.querySelector('.todo-list').children.length;
            document.querySelector('.todo-count').textContent = `你有 ${todoCount} 条待办`;
        }
        
        // 刷新已完成列表
        function refreshCompletedList() {
            // 随机选择2条已完成的待办事项
            const completedTodos = [];
            const tempUsedIndices = new Set(usedIndices);
            
            while (completedTodos.length < 2 && tempUsedIndices.size < todoData.length) {
                const randomIndex = Math.floor(Math.random() * todoData.length);
                if (!tempUsedIndices.has(randomIndex)) {
                    completedTodos.push(todoData[randomIndex]);
                    tempUsedIndices.add(randomIndex);
                    usedIndices.add(randomIndex);
                }
            }
            
            // 如果所有数据都已使用，则重置使用状态
            if (tempUsedIndices.size >= todoData.length) {
                usedIndices.clear();
            }
            
            // 渲染已完成的待办事项
            const completedListElement = document.querySelector('.completed-list');
            completedListElement.innerHTML = ''; // 清空默认内容
            
            completedTodos.forEach(todo => {
                const priorityClass = getPriorityClass(todo.priority);
                const typeClass = getTypeClass(todo.type);
                
                const completedItemHTML = `
                    <div class="todo-item">
                        <div class="todo-left">
                            <div class="checkbox checked">
                                <svg width="14" height="10" viewBox="0 0 14 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M1 5L5 9L13 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="todo-text completed">${todo.content}</div>
                        </div>
                        <div class="tag-container">
                            <div class="tag ${priorityClass}">${todo.priority}</div>
                            <div class="tag ${typeClass}">${todo.type}</div>
                        </div>
                    </div>
                `;
                
                completedListElement.innerHTML += completedItemHTML;
            });
            
            // 重新绑定复选框事件
            bindCheckboxEvents();
        }
    </script>
</body>
</html>
